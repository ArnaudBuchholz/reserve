<!doctype html>
<html>
  <head>
    <title>Draw !</title>
    <style>
html, body {
  width:  100%;
  height: 100%;
  margin: 0;
}    
    </style>
  </head>
  <body>
    <canvas></canvas>
  </body>
  <script src="SharedEventSource.js"></script>
  <script>
    const canvas = document.querySelector('canvas')
    const context = canvas.getContext("2d")
    function resize () {
      canvas.width = window.innerWidth
      canvas.height = window.innerHeight
    }
    window.addEventListener('resize', resize)
    resize()
    let draw = false
    canvas.addEventListener('mousemove', event => {
      const { clientX, clientY } = event
      const body = [clientX, clientY].join(',')
      if (draw) {
        fetch('/plots', {
          method: 'POST',
          headers: {
            'Content-Type': 'text/plain',
            'Content-Length': body.length
          },
          body
        })
      }
    })
    canvas.addEventListener('mousedown', event => {
      draw = true
    })
    canvas.addEventListener('mouseup', event => {
      draw = false
    })
    function plot(x, y) {
      context.beginPath()
      context.arc(x, y, 10, 0, 2 * Math.PI)
      context.stroke()
    }
    const plotsSource = new SharedEventSource('/plots')
    plotsSource.addEventListener('plot', e => {
      const [rawX, rawY] = e.data.split(',')
      plot(parseInt(rawX, 10), parseInt(rawY, 10))
    })
  </script>
</html>